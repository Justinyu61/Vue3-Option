<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.0.2/vue.global.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
        <title>Document</title>
    </head>
    <body>
        <div id="app" class="mt-2">
            <div class="row h-100">
                <div class="col-md-3 h-100 d-flex flex-column">
                    <!--      search欄位區-->
                    <!--      輸入關鍵字時可以過濾Name找到包含的關鍵字:Computed 常見技巧 搜尋 + filter()-->
                    <div class="form-floating mb-2">
                        <input type="text" class="form-control" id="search" placeholder="search" v-model="cacheSearch">
                        <label for="search">search</label>
                    </div>
                    <!--      顯示地點名稱區-->
                    <!--      過濾後存入在 dataFilter 裡,這裡只需要 Name -->
                    <div class="list-group option">
                        <label class="list-group-item" v-for="(item, key) in dataFilter " :key="'dataFilter' + key" :for="filter">
                            <!--          @click="cacheArea = item" 點擊後把item資料與 cacheArea資料比對帶出 就能顯示在瀏覽紀錄上-->
                            <!--          :checked樣式來指示是否為勾選的狀態-->
                            <input class="form-check-input me-1" type="radio" name="area" :value="item" :checked="cacheArea.name === item.name" @click="cacheArea = item" :id="filter">
                            {{ item.Name }}
                        </label>
                    </div>
                </div>
                <div class="col-md-8 h-100 d-flex flex-column">
                    <!--      瀏覽紀錄區-->
                    <div class="form-floating">
                        <select  id="cacheArea" class="form-select w-50 mb-2" aria-label="select example" v-model="cacheArea">
                            <option selected disabled value="">瀏覽紀錄</option>
                            <!--          用watch監聽,存放<=10筆瀏覽紀錄進browseLog-->
                            <option v-for="(item, key) in browseLog" :key="'browseLog' + key" :value="item">{{ item.Name }}</option>
                        </select>
                        <label for="cacheArea" >瀏覽紀錄</label>
                    </div>
                    <!--      地圖-->
                    <!--      因為在上方使用@click="cacheArea = item",所以資料也將被帶到這裡顯示需要的資訊?-->
                    <div class="card overflow-auto">
                        <div v-if="cacheArea.Name">
                            <img :src="cacheArea.Picture1" class="card-img-top" :alt="cacheArea.Name">
                            <iframe width="100%" height="300" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                                    :src=`https://maps.google.com.tw/maps?f=q&hl=zh-TW&geocode=&q=${cacheArea.Py},${cacheArea.Px}(${cacheArea.Name})&z=16&output=embed`></iframe>
                            <div class="card-body">
                                <h5 class="card-title">{{ cacheArea.Name }}</h5>
                                <p>{{ cacheArea.Description }}</p>
                            </div>
                        </div>
                        <div v-else class="card-body bg-light">
                            請選擇景點
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            const App = {
                data() {
                    return {
                        //api資料
                        datastore: [],
                        //輸入的瀏覽紀錄
                        cacheArea: '',
                        //輸入關鍵搜查
                        cacheSearch: '',
                        //搜查紀錄
                        browseLog: [],
                    };
                },
                created(){//頁面建立時讀取api寫入datastore
                    const apiUrl = 'https://raw.githubusercontent.com/hexschool/KCGTravel/master/datastore_search.json';
                    axios.get(apiUrl)
                        .then((res) => {
                            // 取得遠端資料
                            // console.log(res.data.result.records)
                            this.datastore = res.data.result.records
                            // console.log(this.datastore)
                        })
                        .catch((err) => {
                            console.log(err)
                        })
                },
                computed: {
                    dataFilter(){//取得datastore然後分解,取得Name 比對cacheSearch輸入的內容作Search
                        return this.datastore.filter((item) => {
                            return item.Name.match(this.cacheSearch)
                        })
                    },
                },
                watch: {
                    //監聽@click="cacheArea = item" 帶入
                    cacheArea(){
                        if (this.browseLog.length < 10){
                            this.browseLog.push( this.cacheArea )
                            // console.log( this.cacheArea )
                            // console.log(this.browseLog)
                        } else {
                            //shift()方法可移除數組第一項將長度固定在長度10
                            this.browseLog.shift()
                            this.browseLog.push( this.cacheArea )
                        }
                    }
                }
            };

            Vue.createApp(App).mount('#app');
        </script>
        <style>
            #app {
                height: 600px;
            }

            .option {
                overflow-y: auto;
            }
        </style>
    </body>
</html>
